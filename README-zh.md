# goaccessor

[![Go Reference](https://pkg.go.dev/badge/github.com/yujiachen-y/goaccessor.svg)](https://pkg.go.dev/github.com/yujiachen-y/goaccessor)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

`goaccessor` 是一个Go工具，设计用于自动化生成你的类型和变量的`getter`和`setter`样板代码。

## 使用方法

```bash
go install github.com/yujiachen-y/goaccessor@latest
```

安装`goaccessor`后，你可以在命令行界面（CLI）中使用，也可以与`//go:generate`指令一起使用。有关更多信息，请查看[示例部分](#示例)。

## 示例

*在[示例文件夹](./example/)中你可以找到一个可运行的'book'示例。*

考虑`book.go`文件：

``` go
package main

//go:generate goaccessor --target Book --getter --setter
type Book struct {
    Title  string
    Author string
}
```

当我们运行`go generate`时，它会创建一个新文件`book_goaccessor.go`：

``` go
// Code generated by "goaccessor --target Book --getter --setter". DO NOT EDIT.

package main

func (b *Book) GetTitle() string {
    return b.Title
}

func (b *Book) SetTitle(title string) {
    b.Title = title
}

func (b *Book) GetAuthor() string {
    return b.Author
}

func (b *Book) SetAuthor(author string) {
    b.Author = author
}
```

### 顶级变量

`goaccessor`不仅适用于结构类型；它也可以处理顶级常量和变量。例如：

``` go
//go:generate goaccessor --target books --getter --setter
var books = map[string]*Book {
    ...
}
```

执行`go generate`后，我们得到：

``` go
func GetBooks() map[string]*Book {
    return books
}

func SetBooks(newBooks map[string]*Book) {
    books = newBooks
}
```

### 复杂情况

在某些情况下，你可能想要以前缀的形式导出顶级变量的特定字段：

``` go
//go:generate goaccessor --target bestSellingBook --field --getter --include Author --prefix BestSelling
var bestSellingBook = &Book{ ... }
```

这个指令会生成：

```go
func GetBestSellingAuthor() string {
    return bestSellingBook.Author
}
```

## 选项

以下是`goaccessor`的可用选项：

| 选项 | 简短选项 | 描述 |
| ------ | ------------ | ----------- |
| --target | -t | 指定要处理的目标。 |
| --getter | -g | 为目标生成`getter`。 |
| --setter | -s | 为目标生成`setter`。 |
| --accessor | -a | 为目标生成`getter`和`setter`。 |
| --pure-getter | -pg | 为目标生成不带 'Get' 前缀的`getter`。 |
| --prefix | -p | 给生成的方法/函数添加前缀。 |
| --field | -f | 将标记（`getter`，`setter`，`accessor`）应用到目标的每个字段（仅适用于结构类型变量）。 |
| --include | -i | 只为指定的字段生成方法（字段应以逗号分隔）。 |
| --exclude | -e | 从方法生成中排除指定的字段（字段应以逗号分隔）。 |

请注意，当使用`--pure-getter`选项时，生成的getter方法将不会有 'Get' 前缀。
例如，对于有`Title`字段的`Book`结构体，getter将会是 `Title()` 而不是 `GetTitle()`。 

## 依赖管理

如果你不想安装`goaccessor`并希望将其作为项目的依赖项使用，按照以下步骤操作：

1. 转到你的项目目录并通过`go mod`添加`goaccessor`依赖项：

``` bash
go get github.com/yujiachen-y/goaccessor@latest
```

2. 创建一个名为`tools.go`的新文件（或者你喜欢的其他名称），并输入以下代码：

``` go
//go:build tools

package main

import (
	_ "github.com/yujiachen-y/goaccessor"
)
```

3. 如果你想要使用`goaccessor`的CLI命令，请使用`go run github.com/yujiachen-y/goaccessor@latest`。

4. 如果你使用`go:generate`指令生成代码，更改指令，像这样：

``` go
//go:generate go run github.com/yujiachen-y/goaccessor@latest -target book
var book Book
```

5. 注意：尽管`goaccessor`是你项目的依赖项，但它不会——也不应该——成为你项目构建结果的一部分。我们在`tools.go`中使用构建标记确保在构建过程中忽略`goaccessor`。